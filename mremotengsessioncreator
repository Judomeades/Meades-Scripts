#Author Mitchell Eades
#This powershell script will take a file with the following format and create an xml compatible with mremoteng for SSH connections
#IP:SSHport:hostname
#Caveat for this, is that we either have to manually modify connections for ssh keys, or we have to always have a putty session saved.
#YOU WILL NEED TO EDIT THE PATHS MANUALLY
#You will also need to fill out the "protected" field as well.  Export a mremoteng session and edit the xml and you'll find hte protected ID.


$filePath ="C:\Users\meades\Documents\testxml.xml" 
$XmlWriter = New-Object System.XMl.XmlTextWriter($filePath,$Null)
$xmlWriter.Formatting = 'Indented'
$xmlWriter.Indentation ="4" 
$xmlWriter.WriteStartDocument() 
$xmlWriter.WriteStartElement("Connections")  
$XmlWriter.WriteAttributeString("Name","Connections")  
$XmlWriter.WriteAttributeString("Export","True")
#$XmlWriter.WriteAttributeString("Protected","")
$XmlWriter.WriteAttributeString("ConfVersion","2.5")
$xmlWriter.WriteStartElement("Node")  
$XmlWriter.WriteAttributeString("Name","Connections")  
$xmlWriter.WriteAttributeString("Type","Container") 
$XmlWriter.WriteAttributeString("Expanded","True")
$XmlWriter.WriteAttributeString("Descr","")
$XmlWriter.WriteAttributeString("Icon","mRemoteNG")
$XmlWriter.WriteAttributeString("Panel","General")
$XmlWriter.WriteAttributeString("Username","")
$XmlWriter.WriteAttributeString("Domain","")
$XmlWriter.WriteAttributeString("Password","")
$XmlWriter.WriteAttributeString("Hostname","")
$XmlWriter.WriteAttributeString("Protocol","SSH2")
$XmlWriter.WriteAttributeString("PuttySession","Default Settings")
$XmlWriter.WriteAttributeString("Port","22")
$XmlWriter.WriteAttributeString("ConnectToConsole","False")
$XmlWriter.WriteAttributeString("UseCredSsp","True")
$XmlWriter.WriteAttributeString("RenderingEngine","IE")
$XmlWriter.WriteAttributeString("ICAEncryptionStrength","EncrBasic")
$XmlWriter.WriteAttributeString("RDPAuthenticationLevel","NoAuth")
$XmlWriter.WriteAttributeString("LoadBalanceInfo","")
$XmlWriter.WriteAttributeString("Colors","Colors16Bit")
$XmlWriter.WriteAttributeString("Resolution","FitToWindow")
$XmlWriter.WriteAttributeString("AutomaticResize","True")
$XmlWriter.WriteAttributeString("DisplayWallpaper","False")
$XmlWriter.WriteAttributeString("DisplayThemes","False")
$XmlWriter.WriteAttributeString("EnableFontSmoothing","False")
$XmlWriter.WriteAttributeString("EnableDesktopComposition","False")
$XmlWriter.WriteAttributeString("CacheBitmaps","True")
$XmlWriter.WriteAttributeString("RedirectDiskDrives","False")
$XmlWriter.WriteAttributeString("RedirectPorts","False")
$XmlWriter.WriteAttributeString("RedirectPrinters","False")
$XmlWriter.WriteAttributeString("RedirectSmartCards","False")
$XmlWriter.WriteAttributeString("RedirectSound","DoNotPlay")
$XmlWriter.WriteAttributeString("RedirectKeys","False")
$XmlWriter.WriteAttributeString("Connected","False")
$XmlWriter.WriteAttributeString("PreExtApp","")
$XmlWriter.WriteAttributeString("PostExtApp","")
$XmlWriter.WriteAttributeString("MacAddress","")
$XmlWriter.WriteAttributeString("UserField","")
$XmlWriter.WriteAttributeString("ExtApp","")
$XmlWriter.WriteAttributeString("VNCCompression","CompNone")
$XmlWriter.WriteAttributeString("VNCEncoding","EncHextile")
$XmlWriter.WriteAttributeString("VNCAuthMode","AuthVNC")
$XmlWriter.WriteAttributeString("VNCProxyType","ProxyNone")
$XmlWriter.WriteAttributeString("VNCProxyIP","")
$XmlWriter.WriteAttributeString("VNCProxyPort","0")
$XmlWriter.WriteAttributeString("VNCProxyUsername","")
$XmlWriter.WriteAttributeString("VNCProxyPassword","")
$XmlWriter.WriteAttributeString("VNCColors","ColNormal")
$XmlWriter.WriteAttributeString("VNCSmartSizeMode","SmartSAspect")
$XmlWriter.WriteAttributeString("VNCViewOnly","False")
$XmlWriter.WriteAttributeString("RDGatewayUsageMethod","Never")
$XmlWriter.WriteAttributeString("RDGatewayHostname","")
$XmlWriter.WriteAttributeString("RDGatewayUseConnectionCredentials","Yes")
$XmlWriter.WriteAttributeString("RDGatewayUsername","")
$XmlWriter.WriteAttributeString("RDGatewayPassword","")
$XmlWriter.WriteAttributeString("RDGatewayDomain","")
$XmlWriter.WriteAttributeString("InheritCacheBitmaps","False")
$XmlWriter.WriteAttributeString("InheritColors","False")
$XmlWriter.WriteAttributeString("InheritDescription","False")
$XmlWriter.WriteAttributeString("InheritDisplayThemes","False")
$XmlWriter.WriteAttributeString("InheritDisplayWallpaper","False")
$XmlWriter.WriteAttributeString("InheritEnableFontSmoothing","False")
$XmlWriter.WriteAttributeString("InheritEnableDesktopComposition","False")
$XmlWriter.WriteAttributeString("InheritDomain","False")
$XmlWriter.WriteAttributeString("InheritIcon","False")
$XmlWriter.WriteAttributeString("InheritPanel","False")
$XmlWriter.WriteAttributeString("InheritPassword","False")
$XmlWriter.WriteAttributeString("InheritPort","False")
$XmlWriter.WriteAttributeString("InheritProtocol","False")
$XmlWriter.WriteAttributeString("InheritPuttySession","False")
$XmlWriter.WriteAttributeString("InheritRedirectDiskDrives","False")
$XmlWriter.WriteAttributeString("InheritRedirectKeys","False")
$XmlWriter.WriteAttributeString("InheritRedirectPorts","False")
$XmlWriter.WriteAttributeString("InheritRedirectPrinters","False")
$XmlWriter.WriteAttributeString("InheritRedirectSmartCards","False")
$XmlWriter.WriteAttributeString("InheritRedirectSound","False")
$XmlWriter.WriteAttributeString("InheritResolution","False")
$XmlWriter.WriteAttributeString("InheritAutomaticResize","False")
$XmlWriter.WriteAttributeString("InheritUseConsoleSession","False")
$XmlWriter.WriteAttributeString("InheritUseCredSsp","False")
$XmlWriter.WriteAttributeString("InheritRenderingEngine","False")
$XmlWriter.WriteAttributeString("InheritUsername","False")
$XmlWriter.WriteAttributeString("InheritICAEncryptionStrength","False")
$XmlWriter.WriteAttributeString("InheritRDPAuthenticationLevel","False")
$XmlWriter.WriteAttributeString("InheritLoadBalanceInfo","False")
$XmlWriter.WriteAttributeString("InheritPreExtApp","False")
$XmlWriter.WriteAttributeString("InheritPostExtApp","False")
$XmlWriter.WriteAttributeString("InheritMacAddress","False")
$XmlWriter.WriteAttributeString("InheritUserField","False")
$XmlWriter.WriteAttributeString("InheritExtApp","False")
$XmlWriter.WriteAttributeString("InheritVNCCompression","False")
$XmlWriter.WriteAttributeString("InheritVNCEncoding","False")
$XmlWriter.WriteAttributeString("InheritVNCAuthMode","False")
$XmlWriter.WriteAttributeString("InheritVNCProxyType","False")
$XmlWriter.WriteAttributeString("InheritVNCProxyIP","False")
$XmlWriter.WriteAttributeString("InheritVNCProxyPort","False")
$XmlWriter.WriteAttributeString("InheritVNCProxyUsername","False")
$XmlWriter.WriteAttributeString("InheritVNCProxyPassword","False")
$XmlWriter.WriteAttributeString("InheritVNCColors","False")
$XmlWriter.WriteAttributeString("InheritVNCSmartSizeMode","False")
$XmlWriter.WriteAttributeString("InheritVNCViewOnly","False")
$XmlWriter.WriteAttributeString("InheritRDGatewayUsageMethod","False")
$XmlWriter.WriteAttributeString("InheritRDGatewayHostname","False")
$XmlWriter.WriteAttributeString("InheritRDGatewayUseConnectionCredentials","False")
$XmlWriter.WriteAttributeString("InheritRDGatewayUsername","False")
$XmlWriter.WriteAttributeString("InheritRDGatewayPassword","False")
$XmlWriter.WriteAttributeString("InheritRDGatewayDomain","False")
	 # $XmlWriter.WriteEndElement()	  
#Connection info
"$ClientID"
$data = Get-Content "C:\Users\meades\Documents\input.txt" 
#$ip = $data[0]
#$port = $data[1]
#$hostname = $data[2]
foreach($line in $data)
{
    $s = $line -split ":"	
	$ip = $s[0]	
	$port = $s[1]
	$hostname = $s[2]
	Write-Host "$ip $port $hostname"
	$xmlWriter.WriteStartElement("Node") 
	$XmlWriter.WriteAttributeString("Name","$hostname")
    $XmlWriter.WriteAttributeString("Type","Connection")
	$XmlWriter.WriteAttributeString("Descr","")
	$XmlWriter.WriteAttributeString("Icon","mRemoteNG")
	$XmlWriter.WriteAttributeString("Panel","General")
	$XmlWriter.WriteAttributeString("Username","")
	$XmlWriter.WriteAttributeString("Domain","")
	$XmlWriter.WriteAttributeString("Password","")
	$XmlWriter.WriteAttributeString("Hostname","$ip")
	$XmlWriter.WriteAttributeString("Protocol","SSH2")
	$XmlWriter.WriteAttributeString("PuttySession","Default Settings")
	$XmlWriter.WriteAttributeString("Port","$port") 
	$XmlWriter.WriteAttributeString("ConnectToConsole","False")
	$XmlWriter.WriteAttributeString("UseCredSsp","True")
	$XmlWriter.WriteAttributeString("RenderingEngine","IE")
	$XmlWriter.WriteAttributeString("ICAEncryptionStrength","EncrBasic")
	$XmlWriter.WriteAttributeString("RDPAuthenticationLevel","NoAuth")
	$XmlWriter.WriteAttributeString("LoadBalanceInfo","")
	$XmlWriter.WriteAttributeString("Colors","Colors16Bit")
	$XmlWriter.WriteAttributeString("Resolution","FitToWindow")
	$XmlWriter.WriteAttributeString("AutomaticResize","True")
	$XmlWriter.WriteAttributeString("DisplayWallpaper","False")
	$XmlWriter.WriteAttributeString("DisplayThemes","False")
	$XmlWriter.WriteAttributeString("EnableFontSmoothing","False")
	$XmlWriter.WriteAttributeString("EnableDesktopComposition","False")
	$XmlWriter.WriteAttributeString("CacheBitmaps","True")
	$XmlWriter.WriteAttributeString("RedirectDiskDrives","False")
	$XmlWriter.WriteAttributeString("RedirectPorts","False")
	$XmlWriter.WriteAttributeString("RedirectPrinters","False")
	$XmlWriter.WriteAttributeString("RedirectSmartCards","False")
	$XmlWriter.WriteAttributeString("RedirectSound","DoNotPlay")
	$XmlWriter.WriteAttributeString("RedirectKeys","False")
	$XmlWriter.WriteAttributeString("Connected","False")
	$XmlWriter.WriteAttributeString("PreExtApp","")
	$XmlWriter.WriteAttributeString("PostExtApp","")
	$XmlWriter.WriteAttributeString("MacAddress","")
	$XmlWriter.WriteAttributeString("UserField","")
	$XmlWriter.WriteAttributeString("ExtApp","")
	$XmlWriter.WriteAttributeString("VNCCompression","CompNone")
	$XmlWriter.WriteAttributeString("VNCEncoding","EncHextile")
	$XmlWriter.WriteAttributeString("VNCAuthMode","AuthVNC")
	$XmlWriter.WriteAttributeString("VNCProxyType","ProxyNone")
	$XmlWriter.WriteAttributeString("VNCProxyIP","")
	$XmlWriter.WriteAttributeString("VNCProxyPort","0")
	$XmlWriter.WriteAttributeString("VNCProxyUsername","")
	$XmlWriter.WriteAttributeString("VNCProxyPassword","")
	$XmlWriter.WriteAttributeString("VNCColors","ColNormal")
	$XmlWriter.WriteAttributeString("VNCSmartSizeMode","SmartSAspect")
	$XmlWriter.WriteAttributeString("VNCViewOnly","False")
	$XmlWriter.WriteAttributeString("RDGatewayUsageMethod","Never")
	$XmlWriter.WriteAttributeString("RDGatewayHostname","")
	$XmlWriter.WriteAttributeString("RDGatewayUseConnectionCredentials","Yes")
	$XmlWriter.WriteAttributeString("RDGatewayUsername","")
	$XmlWriter.WriteAttributeString("RDGatewayPassword","")
	$XmlWriter.WriteAttributeString("RDGatewayDomain","")
	$XmlWriter.WriteAttributeString("InheritCacheBitmaps","False")
	$XmlWriter.WriteAttributeString("InheritColors","False")
	$XmlWriter.WriteAttributeString("InheritDescription","False")
	$XmlWriter.WriteAttributeString("InheritDisplayThemes","False")
	$XmlWriter.WriteAttributeString("InheritDisplayWallpaper","False")
	$XmlWriter.WriteAttributeString("InheritEnableFontSmoothing","False")
	$XmlWriter.WriteAttributeString("InheritEnableDesktopComposition","False")
	$XmlWriter.WriteAttributeString("InheritDomain","False")
	$XmlWriter.WriteAttributeString("InheritIcon","False")
	$XmlWriter.WriteAttributeString("InheritPanel","False")
	$XmlWriter.WriteAttributeString("InheritPassword","False")
	$XmlWriter.WriteAttributeString("InheritPort","False")
	$XmlWriter.WriteAttributeString("InheritProtocol","False")
	$XmlWriter.WriteAttributeString("InheritPuttySession","False")
	$XmlWriter.WriteAttributeString("InheritRedirectDiskDrives","False")
	$XmlWriter.WriteAttributeString("InheritRedirectKeys","False")
	$XmlWriter.WriteAttributeString("InheritRedirectPorts","False")
	$XmlWriter.WriteAttributeString("InheritRedirectPrinters","False")
	$XmlWriter.WriteAttributeString("InheritRedirectSmartCards","False")
	$XmlWriter.WriteAttributeString("InheritRedirectSound","False")
	$XmlWriter.WriteAttributeString("InheritResolution","False")
	$XmlWriter.WriteAttributeString("InheritAutomaticResize","False")
	$XmlWriter.WriteAttributeString("InheritUseConsoleSession","False")
	$XmlWriter.WriteAttributeString("InheritUseCredSsp","False")
	$XmlWriter.WriteAttributeString("InheritRenderingEngine","False")
	$XmlWriter.WriteAttributeString("InheritUsername","False")
	$XmlWriter.WriteAttributeString("InheritICAEncryptionStrength","False")
	$XmlWriter.WriteAttributeString("InheritRDPAuthenticationLevel","False")
	$XmlWriter.WriteAttributeString("InheritLoadBalanceInfo","False")
	$XmlWriter.WriteAttributeString("InheritPreExtApp","False")
	$XmlWriter.WriteAttributeString("InheritPostExtApp","False")
	$XmlWriter.WriteAttributeString("InheritMacAddress","False")
	$XmlWriter.WriteAttributeString("InheritUserField","False")
	$XmlWriter.WriteAttributeString("InheritExtApp","False")
	$XmlWriter.WriteAttributeString("InheritVNCCompression","False")
	$XmlWriter.WriteAttributeString("InheritVNCEncoding","False")
	$XmlWriter.WriteAttributeString("InheritVNCAuthMode","False")
	$XmlWriter.WriteAttributeString("InheritVNCProxyType","False")
	$XmlWriter.WriteAttributeString("InheritVNCProxyIP","False")
	$XmlWriter.WriteAttributeString("InheritVNCProxyPort","False")
	$XmlWriter.WriteAttributeString("InheritVNCProxyUsername","False")
	$XmlWriter.WriteAttributeString("InheritVNCProxyPassword","False")
	$XmlWriter.WriteAttributeString("InheritVNCColors","False")
	$XmlWriter.WriteAttributeString("InheritVNCSmartSizeMode","False")
	$XmlWriter.WriteAttributeString("InheritVNCViewOnly","False")
	$XmlWriter.WriteAttributeString("InheritRDGatewayUsageMethod","False")
	$XmlWriter.WriteAttributeString("InheritRDGatewayHostname","False")
	$XmlWriter.WriteAttributeString("InheritRDGatewayUseConnectionCredentials","False")
	$XmlWriter.WriteAttributeString("InheritRDGatewayUsername","False")
	$XmlWriter.WriteAttributeString("InheritRDGatewayPassword","False")
	$XmlWriter.WriteAttributeString("InheritRDGatewayDomain","False")
    $XmlWriter.WriteEndElement()  
}
 # Write Close Tag for Root Element  
 $xmlWriter.WriteEndElement() # <-- Closing RootElement  
 # End the XML Document  
 $xmlWriter.WriteEndDocument()  
 # Finish The Document   
 $xmlWriter.Close()  
 
(Get-Content C:\Users\meades\Documents\testxml.xml) -replace 'xml version="1.0"', 'xml version="1.0" encoding="utf-8"' | Set-Content C:\users\meades\documents\testxml.xml
